<style>
#map-canvas {
height: 400px !important;
}
</style>
<p id="notice"><%= notice %></p>


<main class="content color-tour">
  <%= content_tag :div, id: "map-canvas", data: { tours: @tour.to_json(methods: [:name]) } do -%>
  <% end -%>


  <header class="content-header">
    <%= image_tag '/images/front_end/icons/pin-tour.svg', class: 'content-header-icon' %>
    <h1 class="content-header-title">  <%= @tour.name %>
    </h1>
    <span>
<%= link_to 'Edit', edit_tour_path(@tour) %> |
<%= link_to 'Back', tours_path %>


</span>
  </header>
  <div class="content-tabs">
  
    <%# if @tour.duration.present? %>
      <div class="content-tabs-item">
        <span>
      <%= image_tag "/images/front_end/icons/clock-yellow.svg", class: "content-tabs-icon" %>
          <%#= t 'tours.tab_duration' %>Duração: <strong><%= @tour.duration %></strong>
        </span>
      </div>
    <%# end %>
    <%# if @tour.distance.present? %>
      <div class="content-tabs-item">
        <span>
          <%= image_tag "/images/front_end/icons/walking.svg", class: "content-tabs-icon" %>
          <%#= t 'tours.tab_distance' %>Distância: <strong><%= @tour.distance %>km</strong>
        </span>
      </div>
    <%# end %>
    <div class="content-tabs-item">
      <span>
        <%= image_tag "/images/front_end/icons/crowd.svg", class: "content-tabs-icon" %>
        <%#= t 'tours.tab_audience' %>Público: <strong><%= @tour.audience %></strong>
      </span>
    </div>
    <div class="content-tabs-item">
      <span>
        <%= image_tag "/images/front_end/icons/heart.svg", class: "content-tabs-icon" %>
        <%#= t 'tours.tab_intensity' %>Dificuldade: <strong><%= @tour.intensity %></strong>
      </span>
    </div>
    <div class="content-tabs-spacer">
    </div>
    <div class="content-tabs-options">
      <%#= link_to "https://www.google.com.br/maps/dir/#{@tour.stops.map(&:place).map(&:coordinates).join('/')}", class: 'content-tabs-options-item', target: '_blank' do %>
        <%= image_tag '/images/front_end/directions.svg', class:'content-tabs-share-icon' %>
      <%# end %>
      <%#= link_to "https://www.facebook.com/sharer/sharer.php?u=#{tour_url(@tour)}", class: 'content-tabs-options-item', target: '_blank' do %>
        <%= image_tag '/images/front_end/facebook-white.svg', class:'content-tabs-share-icon' %>
      <%# end %>
      <%#= link_to "https://twitter.com/home?status=#{tour_url(@tour)}", class: 'content-tabs-options-item', target: '_blank' do %>
        <%= image_tag '/images/front_end/twitter-white.svg', class:'content-tabs-share-icon' %>
      <%# end %>
    </div>
  </div>

  <div class="content-frame">
  <img class="tour-detail-main-photo" src="<%= url_for(@tour.avatar.variant(resize: "800x600")) %>" alt="...">

    <section class="section">
      <h1 class="heading-one">Sobre o Roteiro:<%#= t 'tours.about_the_tour' %></h1>
      <p class="skip-4">
 <div class="weĺl">       
   <%= @tour.description %>
  </div>
  <hr>
       <%= sanitize @tour.details %>
      <%#= markdown_to_html @tour.description.to_s %>
      </p>
    </section>
<h1 class="heading-one">Neste Roteiro:<%#= t 'tours.about_the_tour' %></h1>

    <div style="display: flex; flex-wrap: wrap">
 <%= render 'pois/poicard', obj: @tour_pois %>
 </div>
   <%# @tour.stops.each_with_index do |stop, index| %>
      <%#= render 'stop', stop: stop, index: index + 1  %>
    <%# end %>
  </div>




<%= link_to 'Voltar', groups_path %>

</head>
<script id="jsbin-javascript">
// Generated by CoffeeScript 1.7.1
var GmapsWaypoints,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

GmapsWaypoints = (function() {
  function GmapsWaypoints(element, options) {
    var k;
    this.element = element;
    if (options == null) {
      options = {};
    }
    this.calcRoute = __bind(this.calcRoute, this);
    this.initialize = __bind(this.initialize, this);
    this.directionsService = new google.maps.DirectionsService();
    this.options = {
      latitude: -22.8976661,
      longitude: -47.0468233,
      travelMode: 'DRIVING',
      zoom: 13
      };
    for (k in options) {
      this.options[k] = options[k];
    }
  }

  GmapsWaypoints.prototype.initialize = function() {
    var centerMapLatLng, map, mapOptions;
    this.injectCssForMap();
    this.directionsDisplay = new google.maps.DirectionsRenderer();
    centerMapLatLng = new google.maps.LatLng(this.options.latitude, this.options.longitude);
    mapOptions = {
      zoom: this.options.zoom,
      center: centerMapLatLng
    };
    map = new google.maps.Map(this.element, mapOptions);
    return this.directionsDisplay.setMap(map);
  };

  GmapsWaypoints.prototype.injectCssForMap = function() {
    return $(this.element).css('width', '100%').css('height', '100%');
  };

  GmapsWaypoints.prototype.calcRoute = function(origin, locations, destination) {
    var i, request, waypts;
    waypts = [];
    i = 0;
    while (i < locations.length) {
      waypts.push({
        location: this.prepareLocation(locations[i]),
        stopover: true
      });
      i++;
    }
    request = {
      origin: new google.maps.LatLng(origin.latitude, origin.longitude),
      destination: new google.maps.LatLng(destination.latitude, destination.longitude),
      waypoints: waypts,
      optimizeWaypoints: true,
      travelMode: this.options.travelMode
    };
    return this.directionsService.route(request, (function(_this) {
      return function(response, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          return _this.directionsDisplay.setDirections(response);
        }
      };
    })(this));
  };

  GmapsWaypoints.prototype.prepareLocation = function(loc) {
    if (typeof loc === 'string') {
      return loc;
    } else {
      return "" + loc.latitude + ", " + loc.longitude;
    }
  };

  return GmapsWaypoints;

})();


var gm = new GmapsWaypoints(document.getElementById('map-canvas'), {latitude: -22.8976661, longitude: -47.0468233});
    google.maps.event.addDomListener(window, "load", gm.initialize);

(function($){

    $(window).load(function(){
    gm.calcRoute(
                         {latitude: -22.8976661, longitude: -47.0468233},
                [
          <% @tour_pois.each do |poi| %>

                    {latitude: <%= poi.latitude %>, longitude: <%= poi.longitude %>},

                    <% end %>
                ],
                 {latitude: -22.8976661, longitude: -47.0468233}
            );
 });

 })(jQuery);
</script>
</div>
</div>
</main>